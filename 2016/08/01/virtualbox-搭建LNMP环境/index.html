
<!DOCTYPE html>
<html lang="zh-cn">
    
<head>
    <meta http-equiv="Content-Type" content="text/html" charset="UTF-8" >
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="代码狗的狗窝">
    <title>virtualbox 搭建LNMP环境 - 代码狗的狗窝</title>
    <meta name="author" content="fantiq">
    
    
    
    <meta name="description" content="lnmp 环境搭建 以及 vagrant box文件打包">
<meta property="og:type" content="blog">
<meta property="og:title" content="virtualbox 搭建LNMP环境">
<meta property="og:url" content="/2016/08/01/virtualbox-搭建LNMP环境/index.html">
<meta property="og:site_name" content="代码狗的狗窝">
<meta property="og:description" content="lnmp 环境搭建 以及 vagrant box文件打包">
<meta property="og:updated_time" content="2017-02-20T08:23:06.160Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="virtualbox 搭建LNMP环境">
<meta name="twitter:description" content="lnmp 环境搭建 以及 vagrant box文件打包">
    
    
        
    
    
        <meta property="og:image" content="/assets/images/avatar.jpg"/>
    
    
        <meta property="og:image" content="/2016/08/01/virtualbox-搭建LNMP环境/lnmpa.jpg"/>
        <meta class="swiftype" name="image" data-type="enum" content="/2016/08/01/virtualbox-搭建LNMP环境/lnmpa.jpg" />
    
    
    
    <!--STYLES-->
    <link rel="stylesheet" href="/assets/css/style-ejlztp1tasruqfvoz6xmgqng0anzae8ox7cqjj5yibieqgcmhe9fwxfae6zj.min.css">
    <!--STYLES END-->
    
    
</head>

    <body>
        <div id="blog">
            <!-- Define author's picture -->


    
        
            
        
    

<header id="header" data-behavior="3">
    <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
    <h1 class="header-title">
        <a class="header-title-link" href="/ ">代码狗的狗窝</a>
    </h1>
    
        
            <a  class="header-right-picture "
                href="#about">
        
        
            <img class="header-picture" src="/assets/images/avatar.jpg"/>
        
        </a>
    
</header>

            <!-- Define author's picture -->



        
    

<nav id="sidebar" data-behavior="3">
    
        <div class="sidebar-profile">
            <a href="/#about">
                    <img class="sidebar-profile-picture" src="/assets/images/avatar.jpg"/>
            </a>
            <span class="sidebar-profile-name">fantiq</span>
        </div>
    
    
        <ul class="sidebar-buttons">
        
            <li class="sidebar-button">
                
                    <a  class="sidebar-button-link "
                         href="/ "
                        
                    >
                
                    <i class="sidebar-button-icon fa fa-lg fa-home"></i>
                    <span class="sidebar-button-desc">首页</span>
                </a>
        </li>
        
            <li class="sidebar-button">
                
                    <a  class="sidebar-button-link "
                         href="/all-categories"
                        
                    >
                
                    <i class="sidebar-button-icon fa fa-lg fa-bookmark"></i>
                    <span class="sidebar-button-desc">分类</span>
                </a>
        </li>
        
            <li class="sidebar-button">
                
                    <a  class="sidebar-button-link "
                         href="/all-tags"
                        
                    >
                
                    <i class="sidebar-button-icon fa fa-lg fa-tags"></i>
                    <span class="sidebar-button-desc">标签</span>
                </a>
        </li>
        
            <li class="sidebar-button">
                
                    <a  class="sidebar-button-link "
                         href="/all-archives"
                        
                    >
                
                    <i class="sidebar-button-icon fa fa-lg fa-archive"></i>
                    <span class="sidebar-button-desc">归档</span>
                </a>
        </li>
        
            <li class="sidebar-button">
                
                    <a  class="sidebar-button-link st-search-show-outputs"
                         href="#search"
                        
                    >
                
                    <i class="sidebar-button-icon fa fa-lg fa-search"></i>
                    <span class="sidebar-button-desc">搜索</span>
                </a>
        </li>
        
            <li class="sidebar-button">
                
                    <a  class="sidebar-button-link "
                         href="#about"
                        
                    >
                
                    <i class="sidebar-button-icon fa fa-lg fa-question"></i>
                    <span class="sidebar-button-desc">关于</span>
                </a>
        </li>
        
    </ul>
    
        <ul class="sidebar-buttons">
        
            <li class="sidebar-button">
                
                    <a  class="sidebar-button-link "
                         href="https://github.com/fantiq"
                    >
                
                    <i class="sidebar-button-icon fa fa-lg fa-github"></i>
                    <span class="sidebar-button-desc">GitHub</span>
                </a>
        </li>
        
    </ul>
    
</nav>

            
            <div id="main" data-behavior="3"
                 class="
                        hasCoverMetaIn
                        ">
                
<article class="post" itemscope itemType="http://schema.org/BlogPosting">
    
    
        <div class="post-header main-content-wrap text-left">
    
        <h1 class="post-title" itemprop="headline">
            virtualbox 搭建LNMP环境
        </h1>
    
    <div class="post-meta">
    <time itemprop="datePublished" content="Mon Aug 01 2016 10:20:11 GMT+0800">
	
		    8月 01, 2016
    	
    </time>
    
        <span>发布在 </span>
        
    <a class="category-link" href="/categories/运维/">运维</a>


    
</div>
</div>
    
    <div class="post-content markdown" itemprop="articleBody">
        <div class="main-content-wrap">
            <p>lnmp 环境搭建 以及 vagrant box文件打包</p>
<a id="more"></a>
<h2 id="1-virtualbox-centos-6-5-安装"><a href="#1-virtualbox-centos-6-5-安装" class="headerlink" title="1. virtualbox centos 6.5 安装"></a>1. virtualbox centos 6.5 安装</h2><p><a href="https://www.virtualbox.org/wiki/Downloads" target="_blank" rel="external">virtualbox 下载地址</a><br><a href="http://www.centoscn.com/CentosSoft/iso/2013/1205/2196.html" target="_blank" rel="external">centos 6.5 x64 下载地址</a><br>安装过程 不再详细记录 记得在启动后读取光盘内容的时候可能需要你手动在设置里面加载下</p>
<h2 id="2-安装后的准备"><a href="#2-安装后的准备" class="headerlink" title="2. 安装后的准备"></a>2. 安装后的准备</h2><h4 id="网络设置"><a href="#网络设置" class="headerlink" title="网络设置"></a>网络设置</h4><figure class="highlight vala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"># 开启ip自动分配</span></span><br><span class="line">vi /etc/sysconfig/network-scripts/ifcfg-eth0</span><br><span class="line">ONBOOT=yes</span><br><span class="line"><span class="meta"># 重启网卡服务</span></span><br><span class="line">service network restart</span><br><span class="line"><span class="meta"># 检查ip</span></span><br><span class="line">ip a</span><br></pre></td></tr></table></figure>
<h4 id="安装wget-vim-等常用工具"><a href="#安装wget-vim-等常用工具" class="headerlink" title="安装wget vim 等常用工具"></a>安装wget vim 等常用工具</h4><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yum <span class="keyword">install</span> wget</span><br><span class="line">yum <span class="keyword">install</span> vim</span><br></pre></td></tr></table></figure>
<h4 id="更换yum源-epel"><a href="#更换yum源-epel" class="headerlink" title="更换yum源 epel"></a>更换yum源 epel</h4><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">rpm -Uvh <span class="string">http:</span><span class="comment">//mirrors.kernel.org/fedora-epel/6/i386/epel-release-6-8.noarch.rpm</span></span><br><span class="line">yum repolist</span><br></pre></td></tr></table></figure>
<h2 id="3-nginx"><a href="#3-nginx" class="headerlink" title="3. nginx"></a>3. nginx</h2><h4 id="下载源码-并解压"><a href="#下载源码-并解压" class="headerlink" title="下载源码 并解压"></a>下载源码 并解压</h4><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">wget https:<span class="comment">//nginx.org/download/nginx-1.10.1.tar.gz</span></span><br><span class="line">tar -zxvf nginx-<span class="number">1.10</span>.<span class="number">1</span><span class="selector-class">.tar</span><span class="selector-class">.gz</span></span><br></pre></td></tr></table></figure>
<h4 id="安装必备工具"><a href="#安装必备工具" class="headerlink" title="安装必备工具"></a>安装必备工具</h4><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yum -y <span class="keyword">install</span> gcc autoconf automake</span><br><span class="line">yum -y <span class="keyword">install</span> zlib zlib-devel openssl openssl-devel pcre-devel</span><br></pre></td></tr></table></figure>
<h4 id="编译安装"><a href="#编译安装" class="headerlink" title="编译安装"></a>编译安装</h4><figure class="highlight haml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">cd nginx-1.10.1</span><br><span class="line"></span><br><span class="line">./configure \</span><br><span class="line">-<span class="ruby">-prefix=<span class="regexp">/usr/local</span><span class="regexp">/nginx \</span><br><span class="line"></span></span>-<span class="ruby"><span class="regexp">-sbin-path=/usr</span><span class="regexp">/local/nginx</span><span class="regexp">/sbin/nginx</span> \</span><br><span class="line"></span>-<span class="ruby">-conf-path=<span class="regexp">/usr/local</span><span class="regexp">/nginx/conf</span><span class="regexp">/nginx.conf \</span><br><span class="line"></span></span>-<span class="ruby"><span class="regexp">-error-log-path=/var</span><span class="regexp">/log/nginx</span><span class="regexp">/error.log \</span><br><span class="line"></span></span>-<span class="ruby"><span class="regexp">-pid-path=/var</span><span class="regexp">/run/nginx</span><span class="regexp">/nginx.pid \</span><br><span class="line"></span></span>-<span class="ruby"><span class="regexp">-user=nginx \</span><br><span class="line"></span></span>-<span class="ruby"><span class="regexp">-group=nginx \</span><br><span class="line"></span></span>-<span class="ruby"><span class="regexp">-with-http_ssl_module \</span><br><span class="line"></span></span>-<span class="ruby"><span class="regexp">-with-http_flv_module \</span><br><span class="line"></span></span>-<span class="ruby"><span class="regexp">-with-http_gzip_static_module \</span><br><span class="line"></span></span>-<span class="ruby"><span class="regexp">-http-log-path=/var</span><span class="regexp">/log/nginx</span><span class="regexp">/access.log \</span><br><span class="line"></span></span>-<span class="ruby"><span class="regexp">-http-client-body-temp-path=/var</span><span class="regexp">/tmp/nginx</span><span class="regexp">/client \</span><br><span class="line"></span></span>-<span class="ruby"><span class="regexp">-http-proxy-temp-path=/var</span><span class="regexp">/tmp/nginx</span><span class="regexp">/proxy \</span><br><span class="line"></span></span>-<span class="ruby"><span class="regexp">-http-fastcgi-temp-path=/var</span><span class="regexp">/tmp/nginx</span><span class="regexp">/fcgi \</span><br><span class="line"></span></span>-<span class="ruby"><span class="regexp">-with-http_stub_status_module</span><br><span class="line"></span></span></span><br><span class="line">make &amp;&amp; make install</span><br></pre></td></tr></table></figure>
<h4 id="启动nginx"><a href="#启动nginx" class="headerlink" title="启动nginx"></a>启动nginx</h4><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">##### 添加nginx运行用户以及对应用户组</span></span><br><span class="line">groupadd -r nginx </span><br><span class="line">useradd -s <span class="meta-keyword">/sbin/</span>nologin -g nginx -r nginx</span><br><span class="line"><span class="meta">##### 启动服务</span></span><br><span class="line"><span class="meta-keyword">/usr/</span>local<span class="meta-keyword">/nginx/</span>sbin/nginx -c <span class="meta-keyword">/usr/</span>local<span class="meta-keyword">/nginx/</span>conf/nginx.conf</span><br></pre></td></tr></table></figure>
<p>在启动的过程中报错<br><figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nginx: [emerg] mkdir() <span class="string">"/var/tmp/nginx/client"</span> failed (<span class="number">2</span>: <span class="keyword">No</span> such <span class="keyword">file</span> <span class="keyword">or</span> directory)</span><br></pre></td></tr></table></figure></p>
<p>创建对应的文件即可<br><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p <span class="meta-keyword">/var/</span>tmp<span class="meta-keyword">/nginx/</span>client</span><br></pre></td></tr></table></figure></p>
<p>检查是否启动成功<br><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">ps -ef | grep nginx</span><br><span class="line">--------------------</span></span><br><span class="line">root      9422     1  0 13:25 ?        00:00:00 nginx: master process /usr/local/nginx/sbin/nginx -c /usr/local/nginx/conf/nginx.conf</span><br><span class="line">nginx     9423  9422  0 13:25 ?        00:00:00 nginx: worker process</span><br></pre></td></tr></table></figure></p>
<p>找到nginx进程即启动成功</p>
<h2 id="4-php"><a href="#4-php" class="headerlink" title="4. php"></a>4. php</h2><h4 id="下载源码并解压"><a href="#下载源码并解压" class="headerlink" title="下载源码并解压"></a>下载源码并解压</h4><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">wget http:<span class="comment">//cn2.php.net/distributions/php-7.0.9.tar.gz</span></span><br><span class="line">tar -zxvf php-<span class="number">7.0</span>.<span class="number">9</span><span class="selector-class">.tar</span><span class="selector-class">.gz</span></span><br></pre></td></tr></table></figure>
<h4 id="安装依赖包"><a href="#安装依赖包" class="headerlink" title="安装依赖包"></a>安装依赖包</h4><figure class="highlight elm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title">yum</span> -y install libjpeg libjpeg-devel libpng libpng-devel free<span class="keyword">type</span> freetype-devel libxml2 libxml2-devel <span class="type">MySQL</span> pcre-devel curl curl-devel libmcrypt libmcrypt-devel</span><br></pre></td></tr></table></figure>
<h4 id="编译安装-1"><a href="#编译安装-1" class="headerlink" title="编译安装"></a>编译安装</h4><figure class="highlight haml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">cd php-7.0.9</span><br><span class="line"></span><br><span class="line">./configure \</span><br><span class="line">-<span class="ruby">-prefix=<span class="regexp">/usr/local</span><span class="regexp">/php7 \</span><br><span class="line"></span></span>-<span class="ruby"><span class="regexp">-exec-prefix=/usr</span><span class="regexp">/local/php</span>7 \</span><br><span class="line"></span>-<span class="ruby">-bindir=<span class="regexp">/usr/local</span><span class="regexp">/php7/bin</span> \</span><br><span class="line"></span>-<span class="ruby">-sbindir=<span class="regexp">/usr/local</span><span class="regexp">/php7/sbin</span> \</span><br><span class="line"></span>-<span class="ruby">-includedir=<span class="regexp">/usr/local</span><span class="regexp">/php7/include</span> \</span><br><span class="line"></span>-<span class="ruby">-libdir=<span class="regexp">/usr/local</span><span class="regexp">/php7/lib</span><span class="regexp">/php \</span><br><span class="line"></span></span>-<span class="ruby"><span class="regexp">-mandir=/usr</span><span class="regexp">/local/php</span>7/php/man \</span><br><span class="line"></span>-<span class="ruby">-with-config-file-path=<span class="regexp">/usr/local</span><span class="regexp">/php7/etc</span> \</span><br><span class="line"></span>-<span class="ruby">-with-mysql-sock=<span class="regexp">/var/run</span><span class="regexp">/mysql/mysql</span>.sock \</span><br><span class="line"></span>-<span class="ruby">-with-mcrypt=<span class="regexp">/usr/include</span> \</span><br><span class="line"></span>-<span class="ruby">-with-mhash \</span><br><span class="line"></span>-<span class="ruby">-with-openssl \</span><br><span class="line"></span>-<span class="ruby">-with-mysqli=shared,mysqlnd \</span><br><span class="line"></span>-<span class="ruby">-with-pdo-mysql=shared,mysqlnd \</span><br><span class="line"></span>-<span class="ruby">-with-gd \</span><br><span class="line"></span>-<span class="ruby">-with-iconv \</span><br><span class="line"></span>-<span class="ruby">-with-zlib \</span><br><span class="line"></span>-<span class="ruby">-enable-zip \</span><br><span class="line"></span>-<span class="ruby">-enable-inline-optimization \</span><br><span class="line"></span>-<span class="ruby">-disable-debug \</span><br><span class="line"></span>-<span class="ruby">-disable-rpath \</span><br><span class="line"></span>-<span class="ruby">-enable-shared \</span><br><span class="line"></span>-<span class="ruby">-enable-xml \</span><br><span class="line"></span>-<span class="ruby">-enable-bcmath \</span><br><span class="line"></span>-<span class="ruby">-enable-shmop \</span><br><span class="line"></span>-<span class="ruby">-enable-sysvsem \</span><br><span class="line"></span>-<span class="ruby">-enable-mbregex \</span><br><span class="line"></span>-<span class="ruby">-enable-mbstring \</span><br><span class="line"></span>-<span class="ruby">-enable-ftp \</span><br><span class="line"></span>-<span class="ruby">-enable-gd-native-ttf \</span><br><span class="line"></span>-<span class="ruby">-enable-pcntl \</span><br><span class="line"></span>-<span class="ruby">-enable-sockets \</span><br><span class="line"></span>-<span class="ruby">-with-xmlrpc \</span><br><span class="line"></span>-<span class="ruby">-enable-soap \</span><br><span class="line"></span>-<span class="ruby">-without-pear \</span><br><span class="line"></span>-<span class="ruby">-with-gettext \</span><br><span class="line"></span>-<span class="ruby">-enable-session \</span><br><span class="line"></span>-<span class="ruby">-with-curl \</span><br><span class="line"></span>-<span class="ruby">-with-jpeg-dir \</span><br><span class="line"></span>-<span class="ruby">-with-freetype-dir \</span><br><span class="line"></span>-<span class="ruby">-enable-opcache \</span><br><span class="line"></span>-<span class="ruby">-enable-fpm \</span><br><span class="line"></span>-<span class="ruby">-with-fpm-user=nginx \</span><br><span class="line"></span>-<span class="ruby">-with-fpm-group=nginx \</span><br><span class="line"></span>-<span class="ruby">-without-gdbm \</span><br><span class="line"></span>-<span class="ruby">-enable-fileinfo</span><br><span class="line"></span></span><br><span class="line">make &amp;&amp; make install</span><br></pre></td></tr></table></figure>
<h4 id="添加redis扩展"><a href="#添加redis扩展" class="headerlink" title="添加redis扩展"></a>添加redis扩展</h4><figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 下载解压包</span></span><br><span class="line">wget <span class="symbol">http:</span>/<span class="regexp">/pecl.php.net/get</span><span class="regexp">/redis-3.0.0.tgz</span><br><span class="line">tar -zxvf redis-3.0.0.tgz</span><br><span class="line"># 生成configure 文件</span><br><span class="line">cd redis-3.0.0</span><br><span class="line">/usr</span><span class="regexp">/local/php</span>7/bin/phpize</span><br><span class="line">./configure --<span class="keyword">with</span>-php-config=<span class="regexp">/usr/local</span><span class="regexp">/php7/bin</span><span class="regexp">/php-config</span><br><span class="line">make &amp;&amp; make install</span></span><br></pre></td></tr></table></figure>
<p><a href="http://my.oschina.net/u/1156660/blog/365451" target="_blank" rel="external">参考链接</a></p>
<h4 id="开启-opcache-redis-pdo-mysql-必备扩展"><a href="#开启-opcache-redis-pdo-mysql-必备扩展" class="headerlink" title="开启 opcache redis pdo_mysql 必备扩展"></a>开启 <code>opcache</code> <code>redis</code> <code>pdo_mysql</code> 必备扩展</h4><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-id">#file</span> : etc/php<span class="selector-class">.ini</span></span><br><span class="line"></span><br><span class="line">extension=redis<span class="selector-class">.so</span></span><br><span class="line">extension=pdo_mysql<span class="selector-class">.so</span></span><br><span class="line">zend_extension=opcache.so</span><br></pre></td></tr></table></figure>
<p><a href="http://www.cnblogs.com/HD/p/4554455.html" target="_blank" rel="external">opcache 配置参数参考</a></p>
<h4 id="启动fpm服务"><a href="#启动fpm服务" class="headerlink" title="启动fpm服务"></a>启动fpm服务</h4><p>如果在 <code>etc</code> 目录找不到 <code>php.ini</code> 文件 可以去源代码里面 <code>cp</code> 一份<br><code>php-fpm</code> 配置文件需要准备<br><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta-keyword">/usr/</span>local<span class="meta-keyword">/php7/</span>sbin/php-fpm</span><br></pre></td></tr></table></figure></p>
<h4 id="检查是否启动"><a href="#检查是否启动" class="headerlink" title="检查是否启动"></a>检查是否启动</h4><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">ps -ef | grep php-fpm</span><br><span class="line">-----------------------</span></span><br><span class="line">root     13900     1  0 16:57 ?        00:00:00 php-fpm: master process (/usr/local/php7/etc/php-fpm.conf)</span><br><span class="line">nginx    13901 13900  0 16:57 ?        00:00:00 php-fpm: pool www           </span><br><span class="line">nginx    13902 13900  0 16:57 ?        00:00:00 php-fpm: pool www           </span><br><span class="line">root     13904  1479  0 16:58 pts/0    00:00:00 grep php-fpm</span><br></pre></td></tr></table></figure>
<h4 id="将php添加到系统路径"><a href="#将php添加到系统路径" class="headerlink" title="将php添加到系统路径"></a>将php添加到系统路径</h4><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ln -s <span class="regexp">/usr/</span>local<span class="regexp">/php7/</span>bin<span class="regexp">/php /u</span>sr<span class="regexp">/local/</span>bin</span><br></pre></td></tr></table></figure>
<h2 id="5-nginx-php-fpm"><a href="#5-nginx-php-fpm" class="headerlink" title="5. nginx + php-fpm"></a>5. nginx + php-fpm</h2><p>首先通过ip访问 如果访问不通 查看防火墙<br><figure class="highlight fortran"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service iptables <span class="keyword">status</span></span><br></pre></td></tr></table></figure></p>
<p>如果防火墙开启 请先关闭<br><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service iptables <span class="built_in">stop</span></span><br></pre></td></tr></table></figure></p>
<h4 id="php配置文件开启真实文件路径的支持"><a href="#php配置文件开启真实文件路径的支持" class="headerlink" title="php配置文件开启真实文件路径的支持"></a>php配置文件开启真实文件路径的支持</h4><figure class="highlight nix"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># file : etc/php.ini</span></span><br><span class="line">cgi.<span class="attr">fix_pathinfo=1</span></span><br></pre></td></tr></table></figure>
<h4 id="nginx-配置文件"><a href="#nginx-配置文件" class="headerlink" title="nginx 配置文件"></a>nginx 配置文件</h4><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span> <span class="number">80</span>;</span><br><span class="line">    <span class="attribute">service_name</span> localhost;</span><br><span class="line">    <span class="comment"># 绑定路径 这个要定义在server下</span></span><br><span class="line">    <span class="attribute">root</span> /root/dev;</span><br><span class="line">    <span class="attribute">index</span> index.html index.htm;</span><br><span class="line">    <span class="attribute">location</span> / &#123;&#125;</span><br><span class="line">    <span class="attribute">error_page</span>  <span class="number">500</span> <span class="number">502</span> <span class="number">503</span> <span class="number">504</span> /50x.html;</span><br><span class="line">    <span class="attribute">location</span> = /50x.html &#123;</span><br><span class="line">        <span class="attribute">root</span> html;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="attribute">location</span> <span class="regexp">~ \.php$</span> &#123;</span><br><span class="line">        <span class="comment"># 代理地址 以及转发 端口</span></span><br><span class="line">        <span class="attribute">fastcgi_pass</span> <span class="number">127.0.0.1:9000</span>;</span><br><span class="line">        <span class="attribute">fastcgi_index</span> index.php;</span><br><span class="line">        <span class="comment"># 这个要设置正确 不然 会报 file not found</span></span><br><span class="line">        <span class="comment"># 配合php.ini 的 cgi.fix_pathinfo=1 使用</span></span><br><span class="line">        <span class="attribute">fastcgi_param</span> SCRIPT_FILENAME <span class="variable">$document_root</span><span class="variable">$fastcgi_script_name</span>;</span><br><span class="line">        <span class="attribute">include</span> fastcgi_params;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="6-mysql"><a href="#6-mysql" class="headerlink" title="6. mysql"></a>6. mysql</h2><h4 id="下载解压源码"><a href="#下载解压源码" class="headerlink" title="下载解压源码"></a>下载解压源码</h4><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">wget http:<span class="comment">//dev.mysql.com/get/Downloads/MySQL-5.7/mysql-5.7.14.tar.gz</span></span><br><span class="line">tar -zxvf mysql-<span class="number">5.7</span>.<span class="number">14</span><span class="selector-class">.tar</span><span class="selector-class">.gz</span></span><br><span class="line">cd mysql-<span class="number">5.7</span>.<span class="number">14</span></span><br></pre></td></tr></table></figure>
<h4 id="安装依赖工具"><a href="#安装依赖工具" class="headerlink" title="安装依赖工具"></a>安装依赖工具</h4><p>mysql 5.7 必须的三个依赖<br>ncurses 字符终端处理库<br>cmake 跨平台的编译工具 类似(automake)<br>boost c++ 的一个标准库<br>bison GNU的一个语法分析器<br><figure class="highlight vala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"># 可以通过 rpm -q 查看软件包是否安装</span></span><br><span class="line">yum -y install gcc gcc-c++ ncurses-devel cmake bison</span><br><span class="line"><span class="meta"># 下载 boost</span></span><br><span class="line">wget https:<span class="comment">//sourceforge.net/projects/boost/files/boost/1.59.0/boost_1_59_0.tar.gz</span></span><br><span class="line">tar -zxvf boost_1_59_0.tar.gz</span><br><span class="line">mv boost_1_59_0 /usr/local/boost</span><br><span class="line"><span class="meta"># 创建mysql用户 以及用户组</span></span><br><span class="line">useradd mysql</span><br></pre></td></tr></table></figure></p>
<h4 id="编译安装-2"><a href="#编译安装-2" class="headerlink" title="编译安装"></a>编译安装</h4><figure class="highlight haml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">cmake . \</span><br><span class="line">-<span class="ruby">DCMAKE_INSTALL_PREFIX=<span class="regexp">/usr/local</span><span class="regexp">/mysql \</span><br><span class="line"></span></span>-<span class="ruby"><span class="regexp">DMYSQL_DATADIR=/usr</span><span class="regexp">/local/mysql</span><span class="regexp">/data \</span><br><span class="line"></span></span>-<span class="ruby"><span class="regexp">DDEFAULT_CHARSET=utf8 \</span><br><span class="line"></span></span>-<span class="ruby"><span class="regexp">DDEFAULT_COLLATION=utf8_general_ci \</span><br><span class="line"></span></span>-<span class="ruby"><span class="regexp">DMYSQL_TCP_PORT=3306 \</span><br><span class="line"></span></span>-<span class="ruby"><span class="regexp">DMYSQL_USER=mysql \</span><br><span class="line"></span></span>-<span class="ruby"><span class="regexp">DWITH_MYISAM_STORAGE_ENGINE=1 \</span><br><span class="line"></span></span>-<span class="ruby"><span class="regexp">DWITH_INNOBASE_STORAGE_ENGINE=1 \</span><br><span class="line"></span></span>-<span class="ruby"><span class="regexp">DWITH_ARCHIVE_STORAGE_ENGINE=1 \</span><br><span class="line"></span></span>-<span class="ruby"><span class="regexp">DWITH_BLACKHOLE_STORAGE_ENGINE=1 \</span><br><span class="line"></span></span>-<span class="ruby"><span class="regexp">DWITH_MEMORY_STORAGE_ENGINE=1 \</span><br><span class="line"></span></span>-<span class="ruby"><span class="regexp">DDOWNLOAD_BOOST=1 \</span><br><span class="line"></span></span>-<span class="ruby"><span class="regexp">DWITH_BOOST=/usr</span><span class="regexp">/local/boost</span></span><br><span class="line"></span></span><br><span class="line"># 编译出错需要清除缓存</span><br><span class="line">rm -f CMakeCache.txt</span><br><span class="line">make clean</span><br></pre></td></tr></table></figure>
<blockquote>
<p>顺便一提: php nginx 都是用纯c写的 mysql用的是c++ 在cmkae mysql的时候<br>竟然发现没装gcc-c++ </p>
</blockquote>
<p>编译安装的时候出现如下错误<br><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql Fatal <span class="keyword">error</span>: can't <span class="keyword">close</span> CMakeFiles/innobase.<span class="keyword">dir</span>/sync/sync0rw.<span class="keyword">cc</span>.o: <span class="keyword">No</span> space left <span class="keyword">on</span> device</span><br></pre></td></tr></table></figure></p>
<p>这是因为mysql需要写文件到 <code>/tmp</code> 目录 , 但是在linux上面 <code>/tmp</code> 目录是一个固定大小(十几KB)的目录<br>解决办法就是将系统的临时文件夹换掉(通过修改系统变量来实现)<br><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> /<span class="built_in">home</span>/tmp</span><br><span class="line"># 只在本次登录有效</span><br><span class="line"><span class="keyword">export</span> TMPDIR=/<span class="built_in">home</span>/tmp</span><br></pre></td></tr></table></figure></p>
<p>最后换掉还是不行 是因为虚拟机分配的硬盘容量太小<br>通过增加容量解决编译问题 <a href="">如何给virtualbox硬盘扩容</a></p>
<h4 id="启动服务"><a href="#启动服务" class="headerlink" title="启动服务"></a>启动服务</h4><p>安装后需要先初始化下mysql<br><figure class="highlight vala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"># --initialize 初始化mysql  会给root生成默认随机密码</span></span><br><span class="line"><span class="meta"># --initialize-insecure 初始化mysql 但 不会给root生成随机密码</span></span><br><span class="line"><span class="meta"># --user 指定mysql执行的用户</span></span><br><span class="line"><span class="meta"># --basedir mysql的安装路径</span></span><br><span class="line"><span class="meta"># --datadir 指定数据存储路径 这个路径必须是空文件夹 当然也要有读写权限</span></span><br><span class="line">/usr/local/mysql/bin/mysqld --initialize-insecure --user=mysql --basedir=/usr/local/mysql --datadir=/<span class="keyword">var</span>/lib/mysql/data</span><br></pre></td></tr></table></figure></p>
<p>将mysql安装成服务<br><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">cp /usr/<span class="built_in">local</span>/mysql/support-<span class="built_in">files</span>/mysql.server /etc/init.d/mysqld</span><br><span class="line">chkconfig <span class="comment">--add mysqld</span></span><br><span class="line">chkconfig mysqld <span class="keyword">on</span></span><br><span class="line">service mysqld status</span><br><span class="line"><span class="comment"># 启动mysql的方式</span></span><br><span class="line">service mysqld <span class="built_in">start</span></span><br><span class="line">/etc/init.d/mysqld <span class="built_in">start</span></span><br></pre></td></tr></table></figure></p>
<p>mysql启动时候默认的配置文件是 <code>/etc/my.cnf</code></p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 客户端配置</span></span><br><span class="line"><span class="section">[client]</span></span><br><span class="line"><span class="attr">port</span>=<span class="number">3306</span></span><br><span class="line"><span class="attr">socket</span>=/var/lib/mysql/mysql.sock</span><br><span class="line"><span class="comment">#服务端配置</span></span><br><span class="line"><span class="section">[mysqld]</span></span><br><span class="line"><span class="attr">port</span>=<span class="number">3306</span></span><br><span class="line"><span class="attr">socket</span>=/var/lib/mysql/mysql.sock</span><br><span class="line"><span class="comment"># 文件目录</span></span><br><span class="line"><span class="attr">datadir</span>=/var/lib/mysql/data</span><br><span class="line"><span class="comment"># 服务启动用户</span></span><br><span class="line"><span class="attr">user</span>=mysql</span><br></pre></td></tr></table></figure>
<p><a href="http://www.2cto.com/database/201510/447675.html" target="_blank" rel="external">参考链接</a></p>
<p><a href="http://dev.mysql.com/doc/refman/5.7/en/source-installation.html" target="_blank" rel="external">官方安装参考链接</a></p>
<h2 id="7-其他相关软件"><a href="#7-其他相关软件" class="headerlink" title="7. 其他相关软件"></a>7. 其他相关软件</h2><p>node composer git nfs samba supervisor<br><figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># composer 先将php加入系统路径</span></span><br><span class="line">curl -sS https:<span class="regexp">//getcomposer</span>.org/installer | php</span><br><span class="line">mv composer.phar /usr/<span class="keyword">local</span>/bin/composer</span><br><span class="line">composer -v</span><br><span class="line"></span><br><span class="line"><span class="comment"># git</span></span><br><span class="line">yum -<span class="keyword">y</span> install git</span><br><span class="line"><span class="comment"># redis</span></span><br><span class="line">yum -<span class="keyword">y</span> install redis</span><br><span class="line"><span class="comment"># nfs</span></span><br><span class="line">yum -<span class="keyword">y</span> install nfs-utils</span><br><span class="line">[使用参考链接](http:<span class="regexp">//fantiq</span>.github.io/<span class="number">2016</span>/<span class="number">06</span>/<span class="number">07</span>/linux-centos-%E7%A1%AC%E7%9B%98%E5%85%B1%E4%BA%ABnfs%E4%BD%BF%E7%94%A8%E6%80%BB%E7%BB%93/)</span><br><span class="line"><span class="comment"># samba</span></span><br><span class="line">yum -<span class="keyword">y</span> install samba</span><br><span class="line">[使用参考链接](http:<span class="regexp">//fantiq</span>.github.io/<span class="number">2016</span>/<span class="number">06</span>/<span class="number">07</span>/linux-centos-samba-%E6%96%87%E4%BB%B6%E5%85%B1%E4%BA%AB/)</span><br><span class="line"><span class="comment"># supervisor</span></span><br><span class="line">yum -<span class="keyword">y</span> install supervisor</span><br><span class="line">[使用参考链接](http:<span class="regexp">//fantiq</span>.github.io/<span class="number">2016</span>/<span class="number">06</span>/<span class="number">07</span>/linux-centos-supervisor%E5%AE%88%E6%8A%A4%E8%BF%9B%E7%A8%8B%E6%80%BB%E7%BB%93/)</span><br></pre></td></tr></table></figure></p>
<h2 id="8-virtualbox-增强工具"><a href="#8-virtualbox-增强工具" class="headerlink" title="8. virtualbox 增强工具"></a>8. virtualbox 增强工具</h2><h4 id="挂载增强工具光盘"><a href="#挂载增强工具光盘" class="headerlink" title="挂载增强工具光盘"></a>挂载增强工具光盘</h4><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">设备 -&gt; 安装增强工具 -&gt; VBoxGuestAdditions.iso(文件在virtualbox 安装目录 这个iso盘会被自动挂载)</span><br><span class="line">mount <span class="meta-keyword">/dev/</span>cdrom <span class="meta-keyword">/mnt/</span>cdrom</span><br></pre></td></tr></table></figure>
<p>遇到错误提示<br>mount: block device /dev/sr0 is write-protected, mounting read-only<br>是正常的 因为光盘就是 read only 的<br>可以加参数 避免 错误提醒 :<br><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">umount <span class="meta-keyword">/mnt/</span>cdrom</span><br><span class="line">mount -t auto -o ro <span class="meta-keyword">/dev/</span>cdrom <span class="meta-keyword">/mnt/</span>cdrom</span><br></pre></td></tr></table></figure></p>
<p><a href="http://blog.chinaunix.net/uid-8810763-id-2453890.html" target="_blank" rel="external">mount 命令具体参考</a></p>
<h4 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h4><figure class="highlight gauss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"># 安装依赖</span></span><br><span class="line">yum -y install bzip2 <span class="built_in">make</span> automake gcc gcc-c++ kernel-devel kernel-headers</span><br><span class="line"><span class="meta"># 更新linux 内核源码 并重启服务器 [参考](https:<span class="comment">//srobb.net/rhkerndev.html)</span></span></span><br><span class="line">yum update</span><br><span class="line"><span class="meta"># 执行sh脚本</span></span><br><span class="line">./VBoxLinuxAdditions.<span class="keyword">run</span></span><br></pre></td></tr></table></figure>
<p>如果后面有如下错误提示 :<br><figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Building the OpenGL support <span class="class"><span class="keyword">module</span>                         [失败]</span></span><br></pre></td></tr></table></figure></p>
<p>这个问题可以不解决 不想看到这个提示可以在编译的时候忽略这个错误<br><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> MAKE=<span class="string">'/usr/bin/gmake -i'</span></span><br></pre></td></tr></table></figure></p>
<p><a href="http://my.oschina.net/tashi/blog/190060" target="_blank" rel="external">virtualbox 增强包安装 参考</a></p>
<h4 id="如何使用"><a href="#如何使用" class="headerlink" title="如何使用"></a>如何使用</h4><p>先设置虚拟机的共享 <code>设置&gt;共享文件夹&gt;固定分配</code> 自动挂载 启动机器 挂载硬盘<br><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">mount</span> -t vboxsf 共享目录名称 服务器要挂载的目录</span><br></pre></td></tr></table></figure></p>
<h2 id="9-打包成-box文件"><a href="#9-打包成-box文件" class="headerlink" title="9. 打包成 box文件"></a>9. 打包成 box文件</h2><h4 id="1-创建vagrant用户并添加到sudo"><a href="#1-创建vagrant用户并添加到sudo" class="headerlink" title="1 创建vagrant用户并添加到sudo"></a>1 创建vagrant用户并添加到sudo</h4><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">useradd</span> vagrant</span><br><span class="line"><span class="attribute">passwd</span> vagrant</span><br><span class="line"><span class="attribute">vagrant</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加行</span></span><br><span class="line"><span class="attribute">visudo</span></span><br><span class="line"><span class="attribute">vagrant</span> <span class="literal">ALL</span>=(<span class="literal">ALL</span>) NOPASSWD:<span class="literal">ALL</span></span><br></pre></td></tr></table></figure>
<p>sudoer 文件格式<br><figure class="highlight vala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">user host=(run_as) command</span><br><span class="line"><span class="meta"># user 定义用户或者用户组 用户组以 % 开始 如 %vagrant</span></span><br><span class="line"><span class="meta"># host 主机名</span></span><br><span class="line"><span class="meta"># run_as 作为哪个用户执行 不写(run_as) 默认是 root</span></span><br><span class="line"><span class="meta"># command 可执行的命令 这个命令要写全路径 相对路径存在安全问题(用户可以创建同名脚本 以root用户执行脚本 脚本里的命令就可以按照root用户的权限执行了)</span></span><br><span class="line"><span class="meta"># command 前可以通过 NOPASSWD: 来修饰 表示sudo执行命令的时候不用密码</span></span><br><span class="line">%vagrant ALL=(root) NOPASSWD:/usr/sbin/useradd</span><br><span class="line"><span class="meta"># 上面命令定义 vagrant组的用户可以在所有主机以root身份执行 /usr/sbin/useradd 命令且不需要密码</span></span><br></pre></td></tr></table></figure></p>
<p><a href="http://my.oschina.net/aiguozhe/blog/38706" target="_blank" rel="external">参考链接</a></p>
<figure class="highlight vala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#### 2 设置ssh</span></span><br><span class="line">创建文件夹</span><br></pre></td></tr></table></figure>
<h1 id="写入-vagrant-中提供的公钥-到用户-ssh-文件夹的-authorized-keys文件中"><a href="#写入-vagrant-中提供的公钥-到用户-ssh-文件夹的-authorized-keys文件中" class="headerlink" title="写入 vagrant 中提供的公钥 到用户.ssh 文件夹的 authorized_keys文件中"></a>写入 vagrant 中提供的公钥 到用户.ssh 文件夹的 authorized_keys文件中</h1><p>cd /home/vagrant/.ssh<br>wget <a href="https://raw.githubusercontent.com/mitchellh/vagrant/master/keys/vagrant.pub" target="_blank" rel="external">https://raw.githubusercontent.com/mitchellh/vagrant/master/keys/vagrant.pub</a> -O authorized_keys</p>
<p>chmod 600 /home/vagrant/.ssh/authorized_keys<br><figure class="highlight vala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#### 打包box</span></span><br><span class="line"><span class="meta"># 首先通过virtualbox命令查询要打包的虚拟机名称</span></span><br><span class="line">VBoxManage list vms</span><br><span class="line"><span class="meta"># 打包</span></span><br><span class="line">vagrant package --base VBoxName --output dev.box</span><br><span class="line"><span class="meta"># 设置vagrant box存储位置 设置环境变量</span></span><br><span class="line">VAGRANT_HOME</span><br><span class="line"><span class="meta"># 添加box</span></span><br><span class="line">vagrant add box centos65 /foo/bar/dev.box</span><br><span class="line"><span class="meta"># 用box初始化环境 </span></span><br><span class="line">vagrant init centos56</span><br><span class="line"><span class="meta"># 修改配置文件</span></span><br><span class="line">Vagrantfile</span><br><span class="line">config.ssh.insert_key = <span class="literal">false</span></span><br><span class="line"><span class="meta"># 启动</span></span><br><span class="line">vagrant up</span><br></pre></td></tr></table></figure></p>

            
                

            
        </div>
    </div>
    <div id="post-footer" class="post-footer main-content-wrap">
        
            <div class="post-footer-tags">
                <span class="text-color-light text-small">标签</span><br/>
                
    <a class="tag tag--primary tag--small t-link" href="/tags/lnmp/">lnmp</a> <a class="tag tag--primary tag--small t-link" href="/tags/virtualbox/">virtualbox</a>

            </div>
        
        <div class="post-actions-wrap">
    <nav>
        <ul class="post-actions post-action-nav">
            <li class="post-action">
                
                    <a class="post-action-btn btn btn--default tooltip--top" href="/2016/08/09/linux硬盘扩容/"  data-tooltip="linux硬盘扩容">
                
                    <i class="fa fa-angle-left"></i>
                    <span class="hide-xs hide-sm text-small icon-ml">上一篇</span>
                </a>
            </li>
            <li class="post-action">
                
                    <a class="post-action-btn btn btn--default tooltip--top" href="/2016/07/26/vagrant的安装与使用/" data-tooltip="vagrant的安装与使用">
                
                    <span class="hide-xs hide-sm text-small icon-mr">下一篇</span>
                    <i class="fa fa-angle-right"></i>
                </a>
            </li>
        </ul>
    </nav>
    <ul class="post-actions post-action-share">
        <li class="post-action hide-lg hide-md hide-sm">
            <a class="post-action-btn btn btn--default btn-open-shareoptions"  href="#btn-open-shareoptions">
                <i class="fa fa-share-alt"></i>
            </a>
        </li>
        <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://plus.google.com/share?url=/2016/08/01/virtualbox-搭建LNMP环境/">
                <i class="fa fa-google-plus"></i>
            </a>
        </li>
        <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://www.facebook.com/sharer/sharer.php?u=/2016/08/01/virtualbox-搭建LNMP环境/">
                <i class="fa fa-facebook-official"></i>
            </a>
        </li>
        <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=/2016/08/01/virtualbox-搭建LNMP环境/">
                <i class="fa fa-twitter"></i>
            </a>
        </li>
        
            <li class="post-action">
                <a class="post-action-btn btn btn--default" href="#ds-thread">
                    <i class="fa fa-comment-o"></i>
                </a>
            </li>
        
        <li class="post-action">
            
                <a class="post-action-btn btn btn--default" href="#">
            
                <i class="fa fa-list"></i>
            </a>
        </li>
    </ul>
</div>


        
            
                <div id="ds-thread" class="ds-thread" data-thread-key="2016/08/01/virtualbox-搭建LNMP环境/"
     data-title="virtualbox 搭建LNMP环境" data-url="/2016/08/01/virtualbox-搭建LNMP环境/">
</div>

            
        
    </div>
</article>



                <footer id="footer" class="main-content-wrap">
    <span class="copyrights">
        Copyrights &copy; 2017 fantiq. All Rights Reserved.
    </span>
</footer>

            </div>
            
                <div id="bottom-bar" class="post-bottom-bar" data-behavior="3">
                    <div class="post-actions-wrap">
    <nav>
        <ul class="post-actions post-action-nav">
            <li class="post-action">
                
                    <a class="post-action-btn btn btn--default tooltip--top" href="/2016/08/09/linux硬盘扩容/"  data-tooltip="linux硬盘扩容">
                
                    <i class="fa fa-angle-left"></i>
                    <span class="hide-xs hide-sm text-small icon-ml">上一篇</span>
                </a>
            </li>
            <li class="post-action">
                
                    <a class="post-action-btn btn btn--default tooltip--top" href="/2016/07/26/vagrant的安装与使用/" data-tooltip="vagrant的安装与使用">
                
                    <span class="hide-xs hide-sm text-small icon-mr">下一篇</span>
                    <i class="fa fa-angle-right"></i>
                </a>
            </li>
        </ul>
    </nav>
    <ul class="post-actions post-action-share">
        <li class="post-action hide-lg hide-md hide-sm">
            <a class="post-action-btn btn btn--default btn-open-shareoptions"  href="#btn-open-shareoptions">
                <i class="fa fa-share-alt"></i>
            </a>
        </li>
        <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://plus.google.com/share?url=/2016/08/01/virtualbox-搭建LNMP环境/">
                <i class="fa fa-google-plus"></i>
            </a>
        </li>
        <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://www.facebook.com/sharer/sharer.php?u=/2016/08/01/virtualbox-搭建LNMP环境/">
                <i class="fa fa-facebook-official"></i>
            </a>
        </li>
        <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=/2016/08/01/virtualbox-搭建LNMP环境/">
                <i class="fa fa-twitter"></i>
            </a>
        </li>
        
            <li class="post-action">
                <a class="post-action-btn btn btn--default" href="#ds-thread">
                    <i class="fa fa-comment-o"></i>
                </a>
            </li>
        
        <li class="post-action">
            
                <a class="post-action-btn btn btn--default" href="#">
            
                <i class="fa fa-list"></i>
            </a>
        </li>
    </ul>
</div>


                </div>
                <div id="share-options-bar" class="share-options-bar" data-behavior="3">
    <ul class="share-options">
        <li class="share-option">
            <a class="share-option-btn" target="new" href="https://plus.google.com/share?url=/2016/08/01/virtualbox-搭建LNMP环境/">
                <i class="fa fa-google-plus"></i><span class="">分享到 Google+</span>
            </a>
        </li>
        <li class="share-option">
            <a class="share-option-btn" target="new" href="https://www.facebook.com/sharer/sharer.php?u=/2016/08/01/virtualbox-搭建LNMP环境/">
                <i class="fa fa-facebook-official"></i><span>分享到 Facebook</span>
            </a>
        </li>
        <li class="share-option">
            <a class="share-option-btn" target="new" href="https://twitter.com/intent/tweet?text=/2016/08/01/virtualbox-搭建LNMP环境/">
                <i class="fa fa-twitter"></i><span>分享到 Twitter</span>
            </a>
        </li>
    </ul>
</div>
<div id="share-options-mask" class="share-options-mask"></div>
            
        </div>
        


    
        
    

<div id="about">
    <div id="about-card">
        <div id="about-btn-close">
            <i class="fa fa-remove"></i>
        </div>
        
            <img id="about-card-picture" src="/assets/images/avatar.jpg"/>
        
            <h4 id="about-card-name">fantiq</h4>
        
            <h5 id="about-card-bio"><p> good at develop framework </p>
</h5>
        
        
            <h5 id="about-card-job">
                <i class="fa fa-briefcase"></i>
                <br/>
                <p>developer</p>

            </h5>
        
        
            <h5 id="about-card-location">
                <i class="fa fa-map-marker"></i>
                <br/>
                China
            </h5>
        
    </div>
</div>

        
<div id="cover" style="background-image:url('/assets/images/cover.jpg');"></div>
    </body>
    <!--SCRIPTS-->
<script src="/assets/js/scrip-gfmrkxcl0qohe3cfdgxhzvc0yrceqta8i4iix0txvn8q4o2adlqd5n0jmkvt.min.js"></script>
<!--SCRIPTS END-->

    
        <script type="text/javascript">
            var duoshuoQuery = {short_name:'fantiq'};
            (function() {
                var ds = document.createElement('script');
                ds.type = 'text/javascript';ds.async = true;
                ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
                ds.charset = 'UTF-8';
                (document.getElementsByTagName('head')[0]
                || document.getElementsByTagName('body')[0]).appendChild(ds);
            })();
        </script>
    



</html>
