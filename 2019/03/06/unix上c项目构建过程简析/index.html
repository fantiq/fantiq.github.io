
<!DOCTYPE html>
<html lang="zh-cn">
    
<head>
    <meta http-equiv="Content-Type" content="text/html" charset="UTF-8" >
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="代码狗的狗窝">
    <title>unix上c项目构建过程简析 - 代码狗的狗窝</title>
    <meta name="author" content="fantiq">
    
    
    
    <meta name="description" content="对于linux上大多数软件包的编译过程都是 configure make make install 三个步骤来完成，具体分析下这些过程。其中configure 是一个shell脚本，用来生成文件 Makefile，这个文件是下一步make 过程需要用到的配置文件，用来生成源代码文件中的依赖关系，通过文件的修改时间来决定哪些文件有变动需要调用gcc 重新编译到目标文件并最终链接成二进制文件。make">
<meta name="keywords" content="c,configure,make">
<meta property="og:type" content="blog">
<meta property="og:title" content="unix上c项目构建过程简析">
<meta property="og:url" content="/2019/03/06/unix上c项目构建过程简析/index.html">
<meta property="og:site_name" content="代码狗的狗窝">
<meta property="og:description" content="对于linux上大多数软件包的编译过程都是 configure make make install 三个步骤来完成，具体分析下这些过程。其中configure 是一个shell脚本，用来生成文件 Makefile，这个文件是下一步make 过程需要用到的配置文件，用来生成源代码文件中的依赖关系，通过文件的修改时间来决定哪些文件有变动需要调用gcc 重新编译到目标文件并最终链接成二进制文件。make">
<meta property="og:locale" content="zh-cn">
<meta property="og:image" content="/2019/03/06/unix上c项目构建过程简析/WechatIMG123.jpeg">
<meta property="og:updated_time" content="2019-03-08T13:35:50.482Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="unix上c项目构建过程简析">
<meta name="twitter:description" content="对于linux上大多数软件包的编译过程都是 configure make make install 三个步骤来完成，具体分析下这些过程。其中configure 是一个shell脚本，用来生成文件 Makefile，这个文件是下一步make 过程需要用到的配置文件，用来生成源代码文件中的依赖关系，通过文件的修改时间来决定哪些文件有变动需要调用gcc 重新编译到目标文件并最终链接成二进制文件。make">
<meta name="twitter:image" content="/2019/03/06/unix上c项目构建过程简析/WechatIMG123.jpeg">
    
    
        
    
    
        <meta property="og:image" content="/assets/images/avatar.jpg"/>
    
    
    
    
    <!--STYLES-->
    <link rel="stylesheet" href="/assets/css/style-ejlztp1tasruqfvoz6xmgqng0anzae8ox7cqjj5yibieqgcmhe9fwxfae6zj.min.css">
    <!--STYLES END-->
    
    
</head>

    <body>
        <div id="blog">
            <!-- Define author's picture -->


    
        
            
        
    

<header id="header" data-behavior="3">
    <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
    <h1 class="header-title">
        <a class="header-title-link" href="/ ">代码狗的狗窝</a>
    </h1>
    
        
            <a  class="header-right-picture "
                href="#about">
        
        
            <img class="header-picture" src="/assets/images/avatar.jpg"/>
        
        </a>
    
</header>

            <!-- Define author's picture -->



        
    

<nav id="sidebar" data-behavior="3">
    
        <div class="sidebar-profile">
            <a href="/#about">
                    <img class="sidebar-profile-picture" src="/assets/images/avatar.jpg"/>
            </a>
            <span class="sidebar-profile-name">fantiq</span>
        </div>
    
    
        <ul class="sidebar-buttons">
        
            <li class="sidebar-button">
                
                    <a  class="sidebar-button-link "
                         href="/ "
                        
                    >
                
                    <i class="sidebar-button-icon fa fa-lg fa-home"></i>
                    <span class="sidebar-button-desc">首页</span>
                </a>
        </li>
        
            <li class="sidebar-button">
                
                    <a  class="sidebar-button-link "
                         href="/all-categories"
                        
                    >
                
                    <i class="sidebar-button-icon fa fa-lg fa-bookmark"></i>
                    <span class="sidebar-button-desc">分类</span>
                </a>
        </li>
        
            <li class="sidebar-button">
                
                    <a  class="sidebar-button-link "
                         href="/all-tags"
                        
                    >
                
                    <i class="sidebar-button-icon fa fa-lg fa-tags"></i>
                    <span class="sidebar-button-desc">标签</span>
                </a>
        </li>
        
            <li class="sidebar-button">
                
                    <a  class="sidebar-button-link "
                         href="/all-archives"
                        
                    >
                
                    <i class="sidebar-button-icon fa fa-lg fa-archive"></i>
                    <span class="sidebar-button-desc">归档</span>
                </a>
        </li>
        
            <li class="sidebar-button">
                
                    <a  class="sidebar-button-link st-search-show-outputs"
                         href="#search"
                        
                    >
                
                    <i class="sidebar-button-icon fa fa-lg fa-search"></i>
                    <span class="sidebar-button-desc">搜索</span>
                </a>
        </li>
        
            <li class="sidebar-button">
                
                    <a  class="sidebar-button-link "
                         href="#about"
                        
                    >
                
                    <i class="sidebar-button-icon fa fa-lg fa-question"></i>
                    <span class="sidebar-button-desc">关于</span>
                </a>
        </li>
        
    </ul>
    
        <ul class="sidebar-buttons">
        
            <li class="sidebar-button">
                
                    <a  class="sidebar-button-link "
                         href="https://github.com/fantiq"
                    >
                
                    <i class="sidebar-button-icon fa fa-lg fa-github"></i>
                    <span class="sidebar-button-desc">GitHub</span>
                </a>
        </li>
        
    </ul>
    
</nav>

            
            <div id="main" data-behavior="3"
                 class="
                        hasCoverMetaIn
                        ">
                
<article class="post" itemscope itemType="http://schema.org/BlogPosting">
    
    
        <div class="post-header main-content-wrap text-left">
    
        <h1 class="post-title" itemprop="headline">
            unix上c项目构建过程简析
        </h1>
    
    <div class="post-meta">
    <time itemprop="datePublished" content="Wed Mar 06 2019 03:30:30 GMT+0800">
	
		    3月 06, 2019
    	
    </time>
    
        <span>发布在 </span>
        
    <a class="category-link" href="/categories/c/">c</a>


    
</div>
</div>
    
    <div class="post-content markdown" itemprop="articleBody">
        <div class="main-content-wrap">
            <p>对于linux上大多数软件包的编译过程都是 <code>configure</code> <code>make</code> <code>make install</code> 三个步骤来完成，具体分析下这些过程。其中<code>configure</code> 是一个shell脚本，用来生成文件 <code>Makefile</code>，这个文件是下一步<code>make</code> 过程需要用到的配置文件，用来生成源代码文件中的依赖关系，通过文件的修改时间来决定哪些文件有变动需要调用<code>gcc</code> 重新编译到目标文件并最终链接成二进制文件。<code>make install</code> 的过程主要是将编译完成的文件拷贝到指定的文件夹(或者安装目录)，这个安装路径是通过 <code>configure --prefix=[path]</code> 来定义的 默认一般为 <code>/usr/local/bin</code> 。<br><a id="more"></a><br><code>configure</code> 这个shell文件是要通过源代码机遇一系列工具来生成的，作用是用来检查源代码所在的系统是否用户源代码所依赖的库文件 、头文件、二进制文件 等。<br>其生成过程如下图<br><img src="WechatIMG123.jpeg" alt="构建过程"><br>对这个过程进行分析，我们最终需要获得的文件如下 <code>configure</code> <code>Makefile</code> <code>config.h</code> , 生成这些文件需要的输入文件 <code>configure.ac</code> <code>Makefile.am</code> <code>aclocal.m4</code>,这些文件都有对应的语法方式，需要进行逐个分析。</p>
<h3 id="工具"><a href="#工具" class="headerlink" title="工具"></a>工具</h3><p>这里用到的工具有</p>
<table>
<thead>
<tr>
<th>命令</th>
<th>所属命令组</th>
<th>作用</th>
</tr>
</thead>
<tbody>
<tr>
<td>autoscan</td>
<td>autoconf</td>
<td>扫描文件源代码 生成 conifigure.ac 模版</td>
</tr>
<tr>
<td>autoheader</td>
<td>autoconf</td>
<td>生成头文件</td>
</tr>
<tr>
<td>autoconf</td>
<td>autoconf</td>
<td>生成 configure 脚本</td>
</tr>
<tr>
<td>aclocal</td>
<td>automake</td>
<td>生成m4宏 文件</td>
</tr>
<tr>
<td>automake</td>
<td>automake</td>
<td>生成Makefile.in 文件 为下一步生成Makefile 做准备</td>
</tr>
</tbody>
</table>
<p>autoscan 会通过分析源代码生成一个 <code>configure.ac</code> 的模版文件 <code>configure.scan</code>，需要基于 <code>configure.scan</code> 的内容进行编辑<br><code>cp configure.scan configure.ac</code> (这里文件后缀有两种 configure.ac configure.in 这个主要看autoconf工具 默认读取文件的后缀了，目前大部分使用 .ac 作为文件后缀)。 </p>
<h3 id="1-configure-ac"><a href="#1-configure-ac" class="headerlink" title="1. configure.ac"></a>1. configure.ac</h3><p>基于空文件生成的<code>configure.scan</code>文件默认模版如下<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">shell&gt;</span><span class="bash"> autoscan ./</span></span><br><span class="line"><span class="meta">#</span><span class="bash">                                               -*- Autoconf -*-</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Process this file with autoconf to produce a configure script.</span></span><br><span class="line"></span><br><span class="line">AC_PREREQ([2.69])</span><br><span class="line">AC_INIT([FULL-PACKAGE-NAME], [VERSION], [BUG-REPORT-ADDRESS])</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Checks <span class="keyword">for</span> programs.</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Checks <span class="keyword">for</span> libraries.</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Checks <span class="keyword">for</span> header files.</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Checks <span class="keyword">for</span> typedefs, structures, and compiler characteristics.</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Checks <span class="keyword">for</span> library <span class="built_in">functions</span>.</span></span><br><span class="line"></span><br><span class="line">AC_OUTPUT</span><br></pre></td></tr></table></figure></p>
<p>这里面使用的主要是一些类似c语言中的宏，事实上跟宏的原理一样，是被用来替换的，c语言中宏被替换成c代码，这里的宏会被替换成shell脚本代码，我们最后生成的是shell脚本</p>
<p>这些宏是由 <code>autoconf</code> 工具内部定义的</p>
<p>所以这个文件中宏之外的内容都是 shell 脚本代码了</p>
<h4 id="1-1-基本宏"><a href="#1-1-基本宏" class="headerlink" title="1.1 基本宏"></a>1.1 基本宏</h4><p><code>AC_PREREQ([VERSION])</code> 检查autoconf 软件版本是否大于指定版本<br><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">AC_PREREQ</span><span class="params">([<span class="number">2.69</span>])</span></span></span><br></pre></td></tr></table></figure></p>
<p><code>AC_INIT([FULL-PACKAGE-NAME], [VERSION], [BUG-REPORT-ADDRESS])</code> 定义软件包<br>FULL-PACKAGE-NAME 代码包的完整名称<br>VERSION 代码包的版本<br>BUG-REPORT-ADDRESS 代码bug反馈地址 通常为邮箱<br><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">AC_INIT</span>([php-src], [<span class="number">7.4</span>.<span class="number">1</span>], [bug<span class="variable">@php</span>.net])</span><br></pre></td></tr></table></figure></p>
<p><code>AC_MSG_WARN([WRN_MSG])</code> 显示一个<code>warning</code> 提醒 脚本不会中断执行<br><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">AC_MSG_WARN</span><span class="params">(<span class="string">"cannot found lib xxx"</span>)</span></span></span><br></pre></td></tr></table></figure></p>
<p><code>AC_MSG_ERROR([ERR_MSG], [ExitCode])</code> 显示一个错误 且 会中断脚本的执行<br><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">AC_MSG_ERROR</span><span class="params">([library xxx is need], [<span class="number">500</span>])</span></span></span><br></pre></td></tr></table></figure></p>
<h4 id="1-2-依赖检查"><a href="#1-2-依赖检查" class="headerlink" title="1.2 依赖检查"></a>1.2 依赖检查</h4><h5 id="1-2-1-对二进制文件的检查"><a href="#1-2-1-对二进制文件的检查" class="headerlink" title="1.2.1 对二进制文件的检查"></a>1.2.1 对二进制文件的检查</h5><h6 id="使用-autoconf-内置的宏"><a href="#使用-autoconf-内置的宏" class="headerlink" title="使用 autoconf 内置的宏"></a>使用 <code>autoconf</code> 内置的宏</h6><p><code>AC_PROG_CC</code> 检查c编译器<br><code>AC_PROG_GREP</code> 检查grep工具<br><code>AC_PROG_LEX</code> 检查文件处理工具 lex</p>
<h6 id="自定义查找"><a href="#自定义查找" class="headerlink" title="自定义查找"></a>自定义查找</h6><p><code>AC_CHECK_PROG(variable, prog-to-check-for, value-if-found, [value-if-not-found], [path = &#39;$PATH&#39;], [reject])</code></p>
<table>
<thead>
<tr>
<th>参数</th>
<th>作用</th>
</tr>
</thead>
<tbody>
<tr>
<td>variable</td>
<td>变量名称，autoconf 会将当前命令的结果赋值给这个shell变量</td>
</tr>
<tr>
<td>prog-to-check-for</td>
<td>软件执行文件名称</td>
</tr>
<tr>
<td>value-if-found</td>
<td>查找到返回的值 这个值会赋值给 变量 variable</td>
</tr>
<tr>
<td>value-if-not-found</td>
<td>查找不到返回的值 这个值会赋值给 变量 variable</td>
</tr>
<tr>
<td>path</td>
<td>定义查找路径 否则 会通过环境变量 $PATH 查找</td>
</tr>
</tbody>
</table>
<h5 id="1-2-2-查找文件"><a href="#1-2-2-查找文件" class="headerlink" title="1.2.2 查找文件"></a>1.2.2 查找文件</h5><h6 id="检查头文件"><a href="#检查头文件" class="headerlink" title="检查头文件"></a>检查头文件</h6><p>检查一个头文件<br><code>AC_CHECK_HEADER (header-file, [action-if-found], [action-if-not-found], [includes])</code><br>检查多个头文件<br><code>AC_CHECK_HEADERS (header-file . . ., [action-if-found], [action-if-not-found], [includes])</code></p>
<table>
<thead>
<tr>
<th>参数</th>
<th>作用</th>
<th>默认值</th>
</tr>
</thead>
<tbody>
<tr>
<td>header-file</td>
<td>要查找的头文件</td>
<td>required</td>
</tr>
<tr>
<td>action-if-found</td>
<td>如果找到 执行此命令</td>
<td>AC_DEFINE(HAVE_HEADER_FILE_H, 1,[Define to 1 if you have <header-file.h>.]) # 定义头文件 define HAVE_HEADER_FILE_H 1</header-file.h></td>
</tr>
<tr>
<td>action-if-not-found</td>
<td>如果没找到执行此命令</td>
<td>AC_MSG_ERROR([sorry, can’t do anything for you]) # 显示错误</td>
</tr>
<tr>
<td>includes</td>
<td>查找路径</td>
</tr>
</tbody>
</table>
<figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">AC_CHECK_HEADERS (<span class="name">stdio</span>.h)</span><br></pre></td></tr></table></figure>
<h4 id="1-3-配置定义"><a href="#1-3-配置定义" class="headerlink" title="1.3 配置定义"></a>1.3 配置定义</h4><p>定义头文件的输出<br><code>AC_CONFIG_HEADERS (header . . ., [cmds], [init-cmds])</code></p>
<p>定义宏 并 最终输出到 定义的头文件中<br><figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">AC_DEFINE (<span class="name">variable</span>, value, [description])</span><br><span class="line">AC_DEFINE (<span class="name">variable</span>)</span><br></pre></td></tr></table></figure></p>
<figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">AC_SUBST</span>(<span class="params"></span>)</span> ...</span><br></pre></td></tr></table></figure>
<p>宏命令很多 需要的时候还是去看手册吧 比较清晰 虽然是英文的(看文章最后的参考链接)</p>
<h3 id="2-aclocal-m4"><a href="#2-aclocal-m4" class="headerlink" title="2. aclocal.m4"></a>2. aclocal.m4</h3><p>m4 宏 相对简单，m4主要就是做宏的替换 最终输出文本<br><code>acinclude.m4 UserDefineMicro.m4 configure.ac ----- m4 ----&gt; aclocal.m4</code></p>
<p>其中的 用户自定义宏 和 acinclude.m4 是可选择的</p>
<ol>
<li>宏定义<figure class="highlight puppet"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">define</span>(<span class="section">FOO</span>, Bar)dnl</span><br><span class="line">this is a <span class="keyword">define</span> <span class="section">word</span> FOO</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>以上会输出 <code>this is a define word Bar</code> ，主功能就是一个替换 其中的 <code>dnl</code> 是取消一个空行，默认情况下 <code>m4</code> 会在每行之间插入一个空行</p>
<ol>
<li>函数<br>m4 也提供一些函数用来处理字符串 如 <code>substr($str, $from, $to)</code> 切割字符串 <code>len($str)</code> 计算字符串长度 等…</li>
</ol>
<p>详细的m4宏的编辑可以参考 GUN 的手册 </p>
<h3 id="3-Makefile-am"><a href="#3-Makefile-am" class="headerlink" title="3. Makefile.am"></a>3. Makefile.am</h3><p><code>Makefile.am</code> 是用来生成最终的 <code>Makefile</code> 文件，他是更高层次的抽象，最终的<code>Makefile</code> 格式会在接下来介绍。 <code>Makefile.am</code> 主要用来配置哪些源代码需要编译成什么目标文件 以及 要安装到哪些目录</p>
<p>指定文件的编译类型</p>
<table>
<thead>
<tr>
<th>命令</th>
<th>作用</th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>PROGRAMS</td>
<td>可执行程序</td>
<td></td>
</tr>
<tr>
<td>SOURCES</td>
<td>源代码</td>
<td></td>
</tr>
<tr>
<td>HEADERS</td>
<td>头文件</td>
<td></td>
</tr>
<tr>
<td>LIBRARIES</td>
<td>库文件</td>
<td></td>
</tr>
<tr>
<td>LTLIBRARIES</td>
<td>libtool 库文件</td>
<td></td>
</tr>
<tr>
<td>DATA</td>
<td>不可执行的数据文件</td>
<td></td>
</tr>
<tr>
<td>SCRIPTS</td>
<td>脚本文件</td>
</tr>
</tbody>
</table>
<h3 id="4-make-命令以及-Makefile文件"><a href="#4-make-命令以及-Makefile文件" class="headerlink" title="4. make 命令以及 Makefile文件"></a>4. make 命令以及 Makefile文件</h3><p>Makefile 规则格式 变量 伪目标 包含其他Makefile文件 </p>
<p><code>make</code> 命令 是以文件为输入参数的，可以通过 <code>-f</code> 或 <code>--file</code> 指定文件 ，默认情况在不指定时 <code>make</code> 会在当前文件夹下依次寻找名为 <code>GNUmakefile</code> <code>makefile</code> <code>Makefile</code> 的文件，约定俗成的 以 <code>Makefile</code> 作为文件名。一般情况 <code>make</code> 会将我们的命令作为文本输出 如果不想输出命令文本可以使用 <code>-s</code> 参数</p>
<p>文件语法规则<br><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">target: [prerequisites <span class="string">..</span> <span class="string">..</span> <span class="string">..</span>]</span><br><span class="line">&lt;tab&gt;   <span class="keyword">command</span>;</span><br><span class="line">&lt;tab&gt;   <span class="keyword">command</span>;</span><br><span class="line">        <span class="string">....</span></span><br></pre></td></tr></table></figure></p>
<p>其中<code>target</code> 叫做目标 <code>prerequisites</code> 是一个依赖列表 这些在一般情况下都是文件， 紧接着的一行是shell命令 且要以<code>tab</code>开始才能生效, <code>make</code> 在执行的过程中 先匹配 <code>target</code> 匹配到后检查后面的依赖 如果依赖文件的修改时间晚于 <code>target</code> 文件 则会将这个依赖文件作为 目标 去匹配 所有的都匹配完毕则执行下面的 shell 命令<br>如下一个简单的使用</p>
<p>默认情况下 在执行 <code>make</code> 的时候不指定 目标 <code>make</code> 从第一个定义的 目标开始执行<br><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">main<span class="selector-class">.c</span>: foo<span class="selector-class">.o</span> bar<span class="selector-class">.o</span> </span><br><span class="line">    gcc  ....</span><br></pre></td></tr></table></figure></p>
<p>依赖列表可以为空，我们先不考虑依赖列表 把问题简单化 来理解目标的作用。目标在一般情况下是文件，<code>make</code> 会在源代码目录中查询这个文件 如果文件找不到则会将他当作一个伪目标 继续执行，伪目标也可以声明 让<code>make</code> 免去查询步骤, 声明如下<br><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"><span class="meta-keyword">.PHONY</span>: foo bar</span></span><br><span class="line"><span class="section">foo:</span></span><br><span class="line">    echo <span class="string">"foo"</span>;</span><br><span class="line"><span class="section">bar:</span></span><br><span class="line">    echo <span class="string">"bar"</span>;</span><br></pre></td></tr></table></figure></p>
<p>执行 <code>make -s</code> 输出 <code>foo</code><br>执行 <code>make -s bar</code> 输出 <code>foo</code><br>执行 <code>make -s foo</code> 输出 <code>foo</code></p>
<p>增加依赖列表进来 理解<code>make</code> 的递归操作 为了便于理解 这里仅使用伪目标<br><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">.PHNOY:</span> foo <span class="keyword">bar </span><span class="keyword">baz</span></span><br><span class="line"><span class="keyword">foo: </span><span class="keyword">bar</span></span><br><span class="line"><span class="keyword"> </span>   echo <span class="string">"foo"</span><span class="comment">;</span></span><br><span class="line"><span class="keyword">bar: </span><span class="keyword">baz</span></span><br><span class="line"><span class="keyword"> </span>   echo <span class="string">"bar"</span><span class="comment">;</span></span><br><span class="line"><span class="keyword">baz:</span></span><br><span class="line"><span class="keyword"> </span>   echo <span class="string">"baz"</span><span class="comment">;</span></span><br></pre></td></tr></table></figure></p>
<p>执行<code>make</code> 先执行第一个目标 <code>foo</code> 然后 <code>foo</code> 依赖 <code>bar</code> 则递归的先去匹配执行 目标 <code>bar</code> ，目标 <code>bar</code> 匹配到 但是他又 依赖 <code>baz</code>  则继续递归执行到 <code>baz</code> , 目标 <code>baz</code> 没有依赖 则 执行他的shell 命令 执行完毕 回到 <code>bar</code> ，<code>bar</code> 下面的 <code>biz</code> 目标处理完毕 后面没有 依赖目标 则 执行 <code>bar</code> 的shell 然后回退到  <code>foo</code><br>所以最终的输出是<br><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">baz</span></span><br><span class="line"><span class="keyword">bar</span></span><br><span class="line"><span class="keyword">foo</span></span><br></pre></td></tr></table></figure></p>
<p>注意 <strong>这里面每个目标都只会执行一次</strong></p>
<p>如果文件比较多 文件名列表写起来太繁琐  <code>make</code> 提供变量的机制的，如下<br><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">.PHNOY:</span> foo <span class="keyword">bar </span><span class="keyword">baz</span></span><br><span class="line"><span class="keyword">foo: </span><span class="keyword">baz </span><span class="keyword">bar</span></span><br><span class="line"><span class="keyword"> </span>   echo <span class="string">"foo"</span><span class="comment">;</span></span><br><span class="line"><span class="keyword">bar:</span></span><br><span class="line"><span class="keyword"> </span>   echo <span class="string">"bar"</span><span class="comment">;</span></span><br><span class="line"><span class="keyword">baz:</span></span><br><span class="line"><span class="keyword"> </span>   echo <span class="string">"baz"</span><span class="comment">;</span></span><br></pre></td></tr></table></figure></p>
<p>可以通过变量的形式简化 将依赖列表 赋值给一个变量 使用的时候 以<code>${var}</code> 的形式使用 如下<br><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">.PHNOY:</span> foo <span class="keyword">bar </span><span class="keyword">baz</span></span><br><span class="line"><span class="keyword"></span></span><br><span class="line"><span class="keyword">targets </span>= <span class="keyword">baz </span><span class="keyword">bar</span></span><br><span class="line"><span class="keyword">foo: </span>$&#123;targets&#125;</span><br><span class="line">    echo <span class="string">"foo"</span><span class="comment">;</span></span><br><span class="line"><span class="keyword">bar:</span></span><br><span class="line"><span class="keyword"> </span>   echo <span class="string">"bar"</span><span class="comment">;</span></span><br><span class="line"><span class="keyword">baz:</span></span><br><span class="line"><span class="keyword"> </span>   echo <span class="string">"baz"</span><span class="comment">;</span></span><br></pre></td></tr></table></figure></p>
<p><code>make</code> 还支持 <code>include</code> 关键字 引入其他的 <code>Makefile</code> 文件<br>如果是文件的话 目标与依赖的比较是根据文件的修改时间 如果目 <code>依赖文件的修改时间晚于标的修改时间</code> 也就是说 依赖的文件更新 则会执行下面的shell命令<br>目标文件不存在也会直接执行下面的shell命令</p>
<h4 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a><em>参考链接</em></h4><blockquote>
<p>  <a href="https://elinux.org/images/4/43/Petazzoni.pdf" target="_blank" rel="noopener">GNU Autotools: a tutorial</a><br>  <a href="https://www.gnu.org/software/autoconf/manual/autoconf.html" target="_blank" rel="noopener">autoconf 手册</a><br>  <a href="https://www.gnu.org/software/m4/manual/m4.html" target="_blank" rel="noopener">m4 手册</a><br>  <a href>automake 手册</a></p>
</blockquote>

            
                

            
        </div>
    </div>
    <div id="post-footer" class="post-footer main-content-wrap">
        
            <div class="post-footer-tags">
                <span class="text-color-light text-small">标签</span><br/>
                
    <a class="tag tag--primary tag--small t-link" href="/tags/c/">c</a> <a class="tag tag--primary tag--small t-link" href="/tags/configure/">configure</a> <a class="tag tag--primary tag--small t-link" href="/tags/make/">make</a>

            </div>
        
        <div class="post-actions-wrap">
    <nav>
        <ul class="post-actions post-action-nav">
            <li class="post-action">
                
                    <a class="post-action-btn btn btn--default tooltip--top" href="/2019/03/11/gdb如何实现对c代码的调试的/"  data-tooltip="gdb如何实现对c代码的调试的">
                
                    <i class="fa fa-angle-left"></i>
                    <span class="hide-xs hide-sm text-small icon-ml">上一篇</span>
                </a>
            </li>
            <li class="post-action">
                
                    <a class="post-action-btn btn btn--default tooltip--top" href="/2019/03/06/gcc的基本使用简介/" data-tooltip="gcc的基本使用简介">
                
                    <span class="hide-xs hide-sm text-small icon-mr">下一篇</span>
                    <i class="fa fa-angle-right"></i>
                </a>
            </li>
        </ul>
    </nav>
    <ul class="post-actions post-action-share">
        <li class="post-action hide-lg hide-md hide-sm">
            <a class="post-action-btn btn btn--default btn-open-shareoptions"  href="#btn-open-shareoptions">
                <i class="fa fa-share-alt"></i>
            </a>
        </li>
        <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://plus.google.com/share?url=/2019/03/06/unix上c项目构建过程简析/">
                <i class="fa fa-google-plus"></i>
            </a>
        </li>
        <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://www.facebook.com/sharer/sharer.php?u=/2019/03/06/unix上c项目构建过程简析/">
                <i class="fa fa-facebook-official"></i>
            </a>
        </li>
        <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=/2019/03/06/unix上c项目构建过程简析/">
                <i class="fa fa-twitter"></i>
            </a>
        </li>
        
            <li class="post-action">
                <a class="post-action-btn btn btn--default" href="#ds-thread">
                    <i class="fa fa-comment-o"></i>
                </a>
            </li>
        
        <li class="post-action">
            
                <a class="post-action-btn btn btn--default" href="#">
            
                <i class="fa fa-list"></i>
            </a>
        </li>
    </ul>
</div>


        
            
                <div id="ds-thread" class="ds-thread" data-thread-key="2019/03/06/unix上c项目构建过程简析/"
     data-title="unix上c项目构建过程简析" data-url="/2019/03/06/unix上c项目构建过程简析/">
</div>

            
        
    </div>
</article>



                <footer id="footer" class="main-content-wrap">
    <span class="copyrights">
        Copyrights &copy; 2021 fantiq. All Rights Reserved.
    </span>
</footer>

            </div>
            
                <div id="bottom-bar" class="post-bottom-bar" data-behavior="3">
                    <div class="post-actions-wrap">
    <nav>
        <ul class="post-actions post-action-nav">
            <li class="post-action">
                
                    <a class="post-action-btn btn btn--default tooltip--top" href="/2019/03/11/gdb如何实现对c代码的调试的/"  data-tooltip="gdb如何实现对c代码的调试的">
                
                    <i class="fa fa-angle-left"></i>
                    <span class="hide-xs hide-sm text-small icon-ml">上一篇</span>
                </a>
            </li>
            <li class="post-action">
                
                    <a class="post-action-btn btn btn--default tooltip--top" href="/2019/03/06/gcc的基本使用简介/" data-tooltip="gcc的基本使用简介">
                
                    <span class="hide-xs hide-sm text-small icon-mr">下一篇</span>
                    <i class="fa fa-angle-right"></i>
                </a>
            </li>
        </ul>
    </nav>
    <ul class="post-actions post-action-share">
        <li class="post-action hide-lg hide-md hide-sm">
            <a class="post-action-btn btn btn--default btn-open-shareoptions"  href="#btn-open-shareoptions">
                <i class="fa fa-share-alt"></i>
            </a>
        </li>
        <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://plus.google.com/share?url=/2019/03/06/unix上c项目构建过程简析/">
                <i class="fa fa-google-plus"></i>
            </a>
        </li>
        <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://www.facebook.com/sharer/sharer.php?u=/2019/03/06/unix上c项目构建过程简析/">
                <i class="fa fa-facebook-official"></i>
            </a>
        </li>
        <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=/2019/03/06/unix上c项目构建过程简析/">
                <i class="fa fa-twitter"></i>
            </a>
        </li>
        
            <li class="post-action">
                <a class="post-action-btn btn btn--default" href="#ds-thread">
                    <i class="fa fa-comment-o"></i>
                </a>
            </li>
        
        <li class="post-action">
            
                <a class="post-action-btn btn btn--default" href="#">
            
                <i class="fa fa-list"></i>
            </a>
        </li>
    </ul>
</div>


                </div>
                <div id="share-options-bar" class="share-options-bar" data-behavior="3">
    <ul class="share-options">
        <li class="share-option">
            <a class="share-option-btn" target="new" href="https://plus.google.com/share?url=/2019/03/06/unix上c项目构建过程简析/">
                <i class="fa fa-google-plus"></i><span class="">分享到 Google+</span>
            </a>
        </li>
        <li class="share-option">
            <a class="share-option-btn" target="new" href="https://www.facebook.com/sharer/sharer.php?u=/2019/03/06/unix上c项目构建过程简析/">
                <i class="fa fa-facebook-official"></i><span>分享到 Facebook</span>
            </a>
        </li>
        <li class="share-option">
            <a class="share-option-btn" target="new" href="https://twitter.com/intent/tweet?text=/2019/03/06/unix上c项目构建过程简析/">
                <i class="fa fa-twitter"></i><span>分享到 Twitter</span>
            </a>
        </li>
    </ul>
</div>
<div id="share-options-mask" class="share-options-mask"></div>
            
        </div>
        


    
        
    

<div id="about">
    <div id="about-card">
        <div id="about-btn-close">
            <i class="fa fa-remove"></i>
        </div>
        
            <img id="about-card-picture" src="/assets/images/avatar.jpg"/>
        
            <h4 id="about-card-name">fantiq</h4>
        
            <h5 id="about-card-bio"><p> good at develop framework </p>
</h5>
        
        
            <h5 id="about-card-job">
                <i class="fa fa-briefcase"></i>
                <br/>
                <p>developer</p>

            </h5>
        
        
            <h5 id="about-card-location">
                <i class="fa fa-map-marker"></i>
                <br/>
                China
            </h5>
        
    </div>
</div>

        
<div id="cover" style="background-image:url('/assets/images/cover.jpg');"></div>
    </body>
    <!--SCRIPTS-->
<script src="/assets/js/scrip-gfmrkxcl0qohe3cfdgxhzvc0yrceqta8i4iix0txvn8q4o2adlqd5n0jmkvt.min.js"></script>
<!--SCRIPTS END-->

    
        <script type="text/javascript">
            var duoshuoQuery = {short_name:'fantiq'};
            (function() {
                var ds = document.createElement('script');
                ds.type = 'text/javascript';ds.async = true;
                ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
                ds.charset = 'UTF-8';
                (document.getElementsByTagName('head')[0]
                || document.getElementsByTagName('body')[0]).appendChild(ds);
            })();
        </script>
    



</html>
